---
layout: post
title: Python Day63
subtitle: Databases with SQLite and SQLAlchemy Included
cover-img: /assets/img/20231129_63_1.png
thumbnail-img: /assets/img/20231129_63_1.png
share-img: /assets/img/20231129_63_1.png
tags: [Day63, SQLite, SQLAlchemy, ë°ì´í„°ë² ì´ìŠ¤, ğŸ› ï¸, ì œê±° í›„ ì¬ì„¤ì¹˜, CRUD]
---
       
<br><br>
         
# Databases with SQLite and SQLAlchemy Included  

<br>

## SQLite  
  
ë§ì´ ì‚¬ìš©ë˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤. íŒŒì´ì¬ì— ê¸°ë³¸ì ìœ¼ë¡œ í¬í•¨ë˜ì–´ ìˆì„ ì •ë„ë¡œ ì¸ê¸°ê°€ ë†’ìŒ  
  
![3](/assets/img/20231129_63_3.png)  

<br>
  
- `cursor = db.cursor()` : ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì œì–´(ë§ˆìš°ìŠ¤í¬ì¸í„°)  
ì—‘ì…€ì´ë‚˜ êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ì‘ì—…í•˜ëŠ” ê²½ìš° ì»¤ì„œë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„° í–‰ì„ ì¶”ê°€í•˜ê±°ë‚˜ ë°ì´í„°ë¥¼ í¸ì§‘/ì‚­ì œí•˜ë©°, SQ ë¼ì´íŠ¸ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìˆ˜ì •í•  ë•Œë„ ì»¤ì„œê°€ í•„ìš”  

<br><br>

### ë°ì´í„°ë² ì´ìŠ¤ í‘œ ë§Œë“¤ê¸°  
  
~~~
cursor.execute("CREATE TABLE books (id INTEGER PRIMARY KEY, title varchar(250) NOT NULL UNIQUE, author varchar(250) NOT NULL, rating FLOAT NOT NULL)")
~~~
  
- `cursor` : ë°ì´í„°ë² ì´ìŠ¤ì˜ ë§ˆìš°ìŠ¤ í¬ì¸í„°ë¡œì„œ ëª¨ë“  ì‘ì—…ì„ ìˆ˜í–‰  
  
- `.execute()` : ì»¤ì„œê°€ ì‘ì—…ì„ ì‹¤í–‰í•˜ë„ë¡ ëª…ë ¹. SQ ë¼ì´íŠ¸ ë°ì´í„°ë² ì´ìŠ¤ì˜ ëª¨ë“  ì‘ì—…ì€ êµ¬ì¡°í™” ì§ˆì˜ì–´(SQL, Structured Query Language)ë¼ëŠ” ëª…ë ¹ì–´ë¡œ í‘œí˜„ë˜ëŠ”ë°, ì´ëŠ” í‚¤ì›Œë“œê°€ ëª¨ë‘ ëŒ€ë¬¸ìë¡œ ì“°ì¸ ì˜ì–´ ë¬¸ì¥ê³¼ ë¹„ìŠ·í•¨
`CREATE TABLE` : ë°ì´í„°ë² ì´ìŠ¤ì— ìƒˆ í‘œë¥¼ ìƒì„±í•˜ëŠ” í‚¤ì›Œë“œë¡œ ì´ ë’¤ì— í‘œ ì´ë¦„ì´ ì˜¤ê²Œ ë¨
  
ğŸ“‘[ê´€ë ¨ ë¬¸ì„œ](https://www.w3schools.com/sql/sql_ref_create_table.asp)  
  
`books` :Â  ìƒì„± ì¤‘ì¸ ìƒˆ í‘œì— ë¶€ì—¬í•œ ì´ë¦„  
  
`()` :Â  CREATE TABLE books ( ) ê´„í˜¸ ì•ˆì— ë“¤ì–´ê°€ëŠ” ë¶€ë¶„ì€ ì´ í‘œì˜ í•„ë“œ, ë˜ëŠ” ì—‘ì…€ ì‹œíŠ¸ì˜ ì—´ ì œëª©  

<br>
  
**ì‹¤í–‰ì‹œ**  
  
![1](/assets/img/20231129_63_1.png)  

<br>  

![2](/assets/img/20231129_63_2.png)  

<br>
  
- SQLì¿¼ë¦¬ëŠ” ì˜¤íƒ€ì— ë§¤ìš° ë¯¼ê°í•¨.   
â‡¨ SQLì•Œì¼€ë¯¸(SQLAlchemy)ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì´ì¬ ì½”ë“œë¥¼ ì‘ì„±  

<br><br>
  
### SQLAlchemy  
  
- ê°ì²´ ê´€ê³„í˜• ë§¤í•‘(ORM, Object Relational Mapping) ë¼ì´ë¸ŒëŸ¬ë¦¬  
ë°ì´í„°ë² ì´ìŠ¤ì˜ ê´€ê³„ë¥¼ ê°ì²´ì— ë§¤í•‘í•  ìˆ˜ ìˆë‹¤  
í•„ë“œëŠ” ê°ì²´ ì†ì„±ì´ ë˜ê³ ,   
í‘œëŠ” ë³„ë„ì˜ í´ë˜ìŠ¤,   
ë°ì´í„°ì˜ ê° í–‰ì€ ìƒˆ ê°œì²´ë¡œ ì •ì˜  
  
ğŸ› ï¸ `from flask_sqlalchemy import SQLAlchemy` ì„¤ì¹˜ í›„ì—ë„ ë¹¨ê°„ì¤„ ë–´ì„ ë•Œ  
  
~~~
í„°ë¯¸ë„ì—
`pip uninstall Flask_SQLAlchemy`
`pip install Flask_SQLAlchemy`
~~~

<br>

**ì˜ˆì‹œ**  
  
```javascript
from flask import Flask
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)

##CREATE DATABASE
app.config['SQLALCHEMY_DATABASE_URI'] = "sqlite:///new-books-collection.db"
# Optional: But it will silence the deprecation warning in the console.
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False
db = SQLAlchemy(app)


##CREATE TABLE
class Book(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(250), unique=True, nullable=False)
    author = db.Column(db.String(250), nullable=False)
    rating = db.Column(db.Float, nullable=False)

    # Optional: this will allow each book object to be identified by its title when printed.
    def __repr__(self):
        return f'<Book {self.title}>'


with app.app_context():
    db.create_all()

# CREATE RECORD
    new_book = Book(id=1, title="Harry Potter", author="J. K. Rowling", rating=9.3)
    db.session.add(new_book)
    db.session.commit()
```

<br><br>

### SQLAlchemyë¥¼ ì‚¬ìš©í•œ CRUDì‘ì—…  
  
**ëª¨ë“  ë ˆì½”ë“œ ì½ê¸°**  
  
```javascript
all_books = session.query(Book).all()
```

<br>

**ì¿¼ë¦¬ë³„ íŠ¹ì • ë ˆì½”ë“œ ì½ê¸°**  
  
```javascript
book = Book.query.filter_by(title="Harry Potter").first()
```

<br>
  
**ì¿¼ë¦¬ë³„ ë ˆì½”ë“œ ì—…ë°ì´íŠ¸í•˜ê¸°**  
  
```javascript
book_to_update = Book.query.filter_by(title="Harry Potter").first()
book_to_update.title = "Harry Potter and the Chamber of Secrets"
db.session.commit()
```

<br>

**ê¸°ë³¸í‚¤ë¡œ ë ˆì½”ë“œ ì—…ë°ì´íŠ¸í•˜ê¸°**  
  
```javascript
book_id = 1
book_to_update = Book.query.get(book_id)
book_to_update.title = "Harry Potter and the Goblet of Fire"
db.session.commit() 
```

<br>

**ê¸°ë³¸í‚¤ë¡œ íŠ¹ì • ë ˆì½”ë“œ ì‚­ì œí•˜ê¸°**  
  
```javascript
book_id = 1
book_to_delete = Book.query.get(book_id)
db.session.delete(book_to_delete)
db.session.commit()
```

<br>

ğŸ’¡
~~~
with app.app_context():
    db.create_all()
~~~

<br>
  
![4](/assets/img/20231129_63_4.png)  

<br>

